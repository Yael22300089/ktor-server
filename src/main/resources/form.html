<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Formulario con Carrusel</title>

    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <style>
        body {
          margin: 0;
          min-height: 100vh;
          background-size: cover;
          background-position: center;
          transition: background-image 1s;
          display: flex;
          align-items: center;
          justify-content: center;
          font-family: Arial;
        }

        .card {
          background: rgba(255,255,255,.95);
          padding: 30px;
          border-radius: 12px;
          width: 420px;
        }

        #mensaje {
          display: none;
          background: #38a169;
          color: white;
          padding: 10px;
          border-radius: 6px;
          margin-bottom: 10px;
          text-align: center;
        }
    </style>
</head>

<body>

<div class="card">
    <div id="mensaje">✅ Formulario enviado correctamente</div>

    <form id="form" enctype="multipart/form-data">
        <input name="nombre" placeholder="Nombre" required>
        <input name="edad" placeholder="Edad" required>
        <input name="correo" placeholder="Correo" required>
        <input name="telefono" placeholder="Teléfono" required>
        <input type="date" name="fecha" required>

        <input type="file" name="imagenes" multiple accept="image/*">

        <div class="g-recaptcha"
             data-sitekey="6LcBlFksAAAAAPxIOh_Fsb4drTvSjvQ2Fcs4ZIly"></div>

        <button>Enviar</button>
    </form>
</div>

<script>
    let fondos = [];
    let index = 0;

    // cargar imágenes guardadas
    fetch('/imagenes')
      .then(r => r.json())
      .then(data => {
        fondos = data;
        iniciar();
      });

    function iniciar() {
      if (!fondos.length) return;
      document.body.style.backgroundImage = `url(${fondos[0]})`;
      setInterval(() => {
        index = (index + 1) % fondos.length;
        document.body.style.backgroundImage = `url(${fondos[index]})`;
      }, 4000);
    }

    // enviar sin recargar
    document.getElementById("form").addEventListener("submit", async e => {
      e.preventDefault();
      const res = await fetch("/enviar", {
        method: "POST",
        body: new FormData(e.target)
      });

      if (res.ok) {
        document.getElementById("mensaje").style.display = "block";
        e.target.reset();
        setTimeout(() => location.reload(), 1500);
      }
    });
</script>

</body>
</html>
