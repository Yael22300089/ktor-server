<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Formulario Moderno</title>

    <style>
        body {
          margin: 0;
          min-height: 100vh;
          background-size: cover;
          background-position: center;
          transition: background-image 1s ease-in-out;
          font-family: 'Segoe UI', sans-serif;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .overlay {
          background: rgba(0,0,0,.55);
          position: absolute;
          inset: 0;
        }

        .card {
          position: relative;
          background: white;
          padding: 35px;
          border-radius: 16px;
          width: 420px;
          box-shadow: 0 20px 40px rgba(0,0,0,.25);
          z-index: 2;
        }

        input, button {
          width: 100%;
          padding: 12px;
          margin-bottom: 12px;
          border-radius: 8px;
          border: 1px solid #ccc;
        }

        button {
          background: linear-gradient(135deg,#667eea,#764ba2);
          color: white;
          border: none;
          cursor: pointer;
        }

        #mensaje {
          display: none;
          background: #38a169;
          color: white;
          padding: 10px;
          border-radius: 8px;
          margin-bottom: 12px;
          text-align: center;
        }
    </style>
</head>

<body>

<div class="overlay"></div>

<div class="card">
    <h2>Registro</h2>

    <div id="mensaje">âœ… Formulario enviado</div>

    <form id="form" enctype="multipart/form-data">
        <input name="nombre" placeholder="Nombre" required>
        <input name="edad" placeholder="Edad" required>
        <input name="correo" placeholder="Correo" required>
        <input name="telefono" placeholder="TelÃ©fono" required>
        <input type="date" name="fecha" required>

        <input type="file" id="imagenes" name="imagenes" multiple accept="image/*">

        <button>Enviar</button>
    </form>
</div>
<script>
    let imagenesServidor = [];
    let imagenesPreview = [];
    let fondos = [];
    let index = 0;
    let intervalo = null;

    /* ðŸ” iniciar carrusel */
    function iniciarCarrusel(lista) {

      if (!lista.length) return;

      if (intervalo) clearInterval(intervalo);

      fondos = lista;
      index = 0;

      document.body.style.backgroundImage = `url(${fondos[0]})`;

      intervalo = setInterval(() => {
        index = (index + 1) % fondos.length;
        document.body.style.backgroundImage = `url(${fondos[index]})`;
      }, 4000);
    }

    /* âœ… CARGAR IMÃGENES GUARDADAS */
    fetch('/imagenes')
      .then(r => r.json())
      .then(data => {
        imagenesServidor = data;
        iniciarCarrusel(imagenesServidor);
      });

    /* âœ… VISTA PREVIA SIN BORRAR LAS GUARDADAS */
    document.getElementById("imagenes").addEventListener("change", e => {

      imagenesPreview = [];

      [...e.target.files].forEach(file => {
        const reader = new FileReader();

        reader.onload = ev => {
          imagenesPreview.push(ev.target.result);
          iniciarCarrusel(imagenesPreview);
        };

        reader.readAsDataURL(file);
      });
    });

    /* ðŸš€ ENVIAR */
    document.getElementById("form").addEventListener("submit", async e => {
      e.preventDefault();

      const res = await fetch("/enviar", {
        method: "POST",
        body: new FormData(e.target)
      });

      if (res.ok) {
        document.getElementById("mensaje").style.display = "block";
        setTimeout(() => location.reload(), 1500);
      }
    });
</script>

</body>
</html>
