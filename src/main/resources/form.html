<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Formulario Moderno</title>

    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <style>
        body{
        margin:0;
        min-height:100vh;
        background-size:cover;
        background-position:center;
        transition:background-image 1s ease-in-out;
        font-family:'Segoe UI',sans-serif;
        }
        .menu{
        position:fixed;
        top:0;
        left:0;
        right:0;
        height:60px;
        background:rgba(0,0,0,.75);
        display:flex;
        align-items:center;
        padding:0 20px;
        }
        .contenido{
        margin-top:80px;
        padding:40px;
        display:flex;
        justify-content:center;
        }
        .card{
        background:white;
        padding:35px;
        border-radius:16px;
        width:420px;
        box-shadow:0 20px 40px rgba(0,0,0,.25);
        display:block;
        }
        input,button{
        width:100%;
        padding:12px;
        margin-bottom:12px;
        border-radius:8px;
        border:1px solid #ccc;
        }
        button{
        background:linear-gradient(135deg,#667eea,#764ba2);
        color:white;
        border:none;
        cursor:pointer;
        }
        #mensaje{
        display:none;
        background:#38a169;
        color:white;
        padding:10px;
        border-radius:8px;
        margin-bottom:12px;
        text-align:center;
        }
    </style>
</head>

<body>

<div class="contenido">
    <div class="card">

        <h2>Registro</h2>

        <div id="mensaje">✅ Formulario enviado</div>

        <form id="form" enctype="multipart/form-data">

            <input name="nombre" placeholder="Nombre" required>
            <input name="edad" placeholder="Edad" required>
            <input name="correo" placeholder="Correo" required>
            <input name="telefono" placeholder="Teléfono" required>
            <input type="date" name="fecha" required>

            <input type="file" id="imagenes" name="imagenes" multiple accept="image/*">

            <div class="g-recaptcha"
                 data-sitekey="6LezqGgsAAAAAHS8EPhxOi1WRM1YZBdV4IPMzxm8"></div>

            <button type="submit">Enviar</button>

        </form>

    </div>
</div>

<script>

    let fondos=[];
    let index=0;
    let intervalo=null;

    function iniciarCarrusel(lista){

    if(!lista.length)return;

    if(intervalo)clearInterval(intervalo);

    fondos=lista;
    index=0;

    document.body.style.backgroundImage=`url(${fondos[0]})`;

    intervalo=setInterval(()=>{
    index=(index+1)%fondos.length;
    document.body.style.backgroundImage=`url(${fondos[index]})`;
    },4000);
    }

    fetch('/imagenes')
    .then(r=>r.json())
    .then(data=>{
    iniciarCarrusel(data);
    });

    document.getElementById("form").addEventListener("submit",async e=>{

    e.preventDefault();

    const btn=e.target.querySelector("button");
    btn.disabled=true;

    const res=await fetch("/enviar",{
    method:"POST",
    body:new FormData(e.target)
    });

    const texto=await res.text();

    if(res.ok){

    document.getElementById("mensaje").style.display="block";

    setTimeout(()=>location.reload(),1500);

    }else{

    alert("Error del servidor:\n"+texto);
    btn.disabled=false;

    }
    });
</script>

</body>
</html>
